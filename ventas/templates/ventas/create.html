{% extends "index/base.html" %}

{% load static %}
{% load widget_tweaks %}
{% block content %}
    
        <div class="container mt-3">
            <h2>Formulario</h2>
            <p>Codigo Humano</p>            
            <h3>
                {% if action == 'add' %}
                    <i class="bi bi-plus-circle"></i>

                {% else %}
                    <i class="bi bi-pencil-square"></i>

                {% endif %}

                {{ title }}
            </h3>
        

            <hr>
            {% csrf_token %}
    <form action="" method="post">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card bg-primary">
                            <div class="card-header">
                                <h3 class="card-title">Detalle Venta</h3>
                            </div>
                            <div class="card-body card bg-white text-black">
                                <div class="form-group">
                                    <label>Buscador de Productos:</label>
                                    <div class="input-group">
                                        <select class="form-control select2" style="width: 100%" name="search">

                                        </select>
                                    </div>
                                    <hr>
                                    <button type="button" class="btn btn-warning btn-sm btnRemove">
                                        <i class="bi bi-trash-fill"></i> VACIAR
                                    </button>
                                </div>
                                <hr>
                                
                                <table class="table table-primary" id="tblProductos" >
                                    <thead>
                                      <tr>
                                          <th scope="col">Eliminar</th>
                                          <th scope="col">Producto</th>
                                          <th scope="col">Categoria</th>
                                          <th scope="col">PVP</th>
                                          <th scope="col">Cantidad</th>
                                          <th scope="col">Subtotal</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      
                                    </tbody>
                                  </table>
                            </div>
                        </div>
                        
                    </div>

                    <div class="col-lg-4">
                        <div class="card bg-primary">
                            <div class="card-header">
                                <h3 class="card-title">Factura <i class="bi bi-basket3"></i></h3>
                            </div>
                            <div class="card-body card bg-white text-black">
                                <input type="hidden" name="action" value="{{ action }}">
                                <div class="form-group">
                                    <label>Fecha de Venta:</label>
                                    {{ form.f_registro }}
                                </div>
                                <div class="form-group">
                                    <label>Cliente:</label>
                                    {{ form.cliente }}
                                </div>
                                <div class="form-group">
                                    <label>Subtotal:</label>
                                    {{ form.subtotal }}
                                </div>
                                <div class="form-group">
                                    <label>Iva:</label>
                                    {{ form.iva }}
                                </div>
                                <div class="form-group">
                                    <label>IVA Calculado:</label>
                                    <input type="text" class="form-control" readonly name="ivacal"  value="0.00" autocomplete="off">
                                </div>
                                <div class="form-group">
                                    <label>Total a pagar:</label>
                                    {{ form.total }}
                                </div>
                                <hr>
                               
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
                        
            <hr>
            <div class="card-footer">
                <button type="submit" class="btn btn-primary btnTest"><i class="bi bi-plus-circle"></i> Guardar</button>
                <a href="{{ list_url }}" class="btn btn-info btnTest"><i class="bi bi-x-circle"></i> Cancelar</a>
            </div>
        </div>
        
    </form>



{% endblock %}

{% block lolo %}


                    
<script type="application/javascript">
    $(function () {
        $('.select2').select2({
            
        });

//CALENDARIO
var fecha_r = $('input[name="f_registro"]');

        fecha_r.datetimepicker({
            format: 'YYYY-MM-DD',
            //date: moment().format("YYYY-MM-DD"),
            locale: 'es',
            keepOpen: false,
            //maxDate: moment().format("YYYY-MM-DD")
        });
        //inserta fecha anterior
        fecha_r.datetimepicker('date', fecha_r.val());

        $("input[name='iva']").TouchSpin({
            min: 0,
            max: 100,
            step: 0.01,
            decimals: 2,
            boostat:5,
            maxboostedstep: 10,
            postfix: '%'
        }).on('change', function(){
            ventas.calcular_factura();
        })
            .val(0.12); 
    });
    
</script>



{% endblock %}

{% block head_list %}
 <script src="{% static 'ventas/js/ventas.js' %}"></script>

 <script>
    ventas.items.productos = {{ det|safe }}
    //ventas.list();
</script>
 
{% endblock %}